# Type - Configuration Audit Script
# Author - Umang Verma
# Application Name - Ubuntu
#!/bin/bash

check_file(){
	x="$t"
	if [ ! -f $x ]; then
		echo "File $x not found"
	fi
}

echo "Audit script for Ubuntu is running. Kindly wait for the script to terminate."

exec > `hostname`_Series3.txt 2>errors3.txt

echo "LIN_00 - System Information"
hostname
/sbin/ifconfig -a|grep "inet addr"



echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "..............................................Network Configuration.................................."
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "..........................................Network Parameters (HOST ONLY).............................."
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"


echo "UBTU_16.04_3.1.1 Ensure IP forwarding is disabled"
sysctl net.ipv4.ip_forward 2>/dev/null
t=$_
check_file $t
echo



echo "*********************************************************************************************************"
echo "*********************************************************************************************************"


echo "UBTU_16.04_3.1.2 Ensure packet redirect sending is disabled"
sysctl net.ipv4.conf.all.send_redirects 2>/dev/null
t=$_
check_file $t
sysctl net.ipv4.conf.default.send_redirects
t=$_
check_file $t
echo


echo "*********************************************************************************************************"
echo "*********************************************************************************************************"

echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "...............................Network Parameters (Host and Router)....................................."
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"


echo "UBTU_16.04_3.2.1. Ensure source routed packets are not accepted"
sysctl net.ipv4.conf.all.accept_source_route 2>/dev/null
t=$_
check_file $t
sysctl net.ipv4.conf.default.accept_source_route
t=$_
check_file $t
echo



echo "*********************************************************************************************************"
echo "*********************************************************************************************************"



echo "UBTU_16.04_3.2.2. Ensure ICMP redirects are not accepted"
sysctl net.ipv4.conf.all.accept_redirects 2>/dev/null
t=$_
check_file $t
sysctl net.ipv4.conf.default.accept_redirects
t=$_
check_file $t
echo



echo "*********************************************************************************************************"
echo "*********************************************************************************************************"


echo "UBTU_16.04_12.3.2.3. Ensure secure ICMP redirects are not accepted"
sysctl net.ipv4.conf.all.secure_redirects 2>/dev/null
t=$_
check_file $t
sysctl net.ipv4.conf.default.secure_redirects
t=$_
check_file $t
echo


echo "*********************************************************************************************************"
echo "*********************************************************************************************************"


echo "UBTU_16.04_3.2.4. Ensure suspicious packets are logged"
sysctl net.ipv4.conf.all.log_martians 2>/dev/null
t=$_
check_file $t
sysctl net.ipv4.conf.default.log_martians
t=$_
check_file $t
echo



echo "*********************************************************************************************************"
echo "*********************************************************************************************************"


echo "UBTU_16.04_3.2.5. Ensure broadcast ICMP requests are ignored"
sysctl net.ipv4.icmp_echo_ignore_broadcasts 2>/dev/null
t=$_
check_file $t
echo


echo "*********************************************************************************************************"
echo "*********************************************************************************************************"



echo "UBTU_16.04_3.2.6. Ensure bogus ICMP responses are ignored"
sysctl net.ipv4.icmp_ignore_bogus_error_responses 2>/dev/null
t=$_
check_file $t
echo



echo "*********************************************************************************************************"
echo "*********************************************************************************************************"



echo "UBTU_16.04_3.2.7. Ensure Reverse Path Filtering is enabled"
sysctl net.ipv4.conf.all.rp_filter 2>/dev/null
t=$_
check_file $t
sysctl net.ipv4.conf.default.rp_filter
t=$_
check_file $t
echo


echo "*********************************************************************************************************"
echo "*********************************************************************************************************"



echo "UBTU_16.04_3.2.8. Ensure TCP SYN Cookies is enabled"
sysctl net.ipv4.tcp_syncookies 2>/dev/null
t=$_
check_file $t
echo



echo "*********************************************************************************************************"
echo "*********************************************************************************************************"





echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "...................................................IPv6..............................................."
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"




echo "UBTU_16.04_3.3.1. Ensure IPv6 router advertisements are not accepted"
sysctl net.ipv6.conf.all.accept_ra 2>/dev/null
t=$_
check_file $t
sysctl net.ipv6.conf.default.accept_ra
t=$_
check_file $t
echo



echo "*********************************************************************************************************"
echo "*********************************************************************************************************"






echo "UBTU_16.04_3.3.2. Ensure IPv6 redirects are not accepted"
sysctl net.ipv6.conf.all.accept_redirects 2>/dev/null
t=$_
check_file $t
sysctl net.ipv6.conf.default.accept_redirects
t=$_
check_file $t
echo



echo "*********************************************************************************************************"
echo "*********************************************************************************************************"


echo "UBTU_16.04_3.3.3. Ensure IPv6 is disabled"
grep "^\s*linux" /boot/grub/grub.cfg 2>/dev/null
t=$_
check_file $t
echo


echo "*********************************************************************************************************"
echo "*********************************************************************************************************"


echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "................................................TCP Wrappers..........................................."
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"


echo "UBTU_16.04_3.4.1. Ensure TCP Wrappers is installed"
dpkg -s tcpd 2>/dev/null
t=$_
check_file $t
echo



echo "*********************************************************************************************************"
echo "*********************************************************************************************************"


echo "UBTU_16.04_3.4.2. Ensure /etc/hosts.allow is configured"
cat /etc/hosts.allow 2>/dev/null
t=$_
check_file $t
echo


echo "*********************************************************************************************************"
echo "*********************************************************************************************************"


echo "UBTU_16.04_3.4.3.Ensure /etc/hosts.deny is configured"
cat /etc/hosts.deny 2>/dev/null
t=$_
check_file $t
echo



echo "*********************************************************************************************************"
echo "*********************************************************************************************************"


echo "UBTU_16.04_3.4.4. Ensure permissions on /etc/hosts.allow are configured"
stat /etc/hosts.allow 2>/dev/null
t=$_
check_file $t
echo


echo "*********************************************************************************************************"
echo "*********************************************************************************************************"


echo "UBTU_16.04_3.4.5.Ensure permissions on /etc/hosts.deny are 644"
stat /etc/hosts.deny 2>/dev/null
t=$_
check_file $t
echo

echo "*********************************************************************************************************"
echo "*********************************************************************************************************"


echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo ".........................................Uncommon Network Protocols..............................."
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"


echo "UBTU_16.04_3.5.1.Ensure DCCP is disabled"
modprobe -n -v dccp 2>/dev/null
t=$_
check_file $t
lsmod | grep dccp
t=$_
check_file $t
echo


echo "*********************************************************************************************************"
echo "*********************************************************************************************************"

echo "UBTU_16.04_3.5.2. Ensure SCTP is disabled"
modprobe -n -v sctp 2>/dev/null
t=$_
check_file $t
lsmod | grep sctp
t=$_
check_file $t
echo


echo "*********************************************************************************************************"
echo "*********************************************************************************************************"


echo "UBTU_16.04_3.5..3. Ensure RDS is disabled"
modprobe -n -v rds 2>/dev/null
t=$_
check_file $t
lsmod | grep rds
t=$_
check_file $t
echo

echo "*********************************************************************************************************"
echo "*********************************************************************************************************"


echo "UBTU_16.04_3.5.4. Ensure TIPC is disabled"
modprobe -n -v tipc 2>/dev/null
t=$_
check_file $t
lsmod | grep tipc
t=$_
check_file $t
echo

echo "*********************************************************************************************************"
echo "*********************************************************************************************************"



echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "...............................................Firewall Configuration..................................."
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"



echo "UBTU_16.04_3.6.1. Ensure iptables is installed"
dpkg -s iptables 2>/dev/null
t=$_
check_file $t
echo


echo "*********************************************************************************************************"
echo "*********************************************************************************************************"


echo "UBTU_16.04_3.6.2. Ensure default deny firewall policy"
iptables -L 2>/dev/null
t=$_
check_file $t
echo


echo "*********************************************************************************************************"
echo "*********************************************************************************************************"

echo "UBTU_16.04_3.6.3. Ensure loopback traffic is configured"
iptables -L INPUT -v -n 2>/dev/null
t=$_
check_file $t
iptables -L OUTPUT -v -n
t=$_
check_file $t
echo




echo "*********************************************************************************************************"
echo "*********************************************************************************************************"


echo "UBTU_16.04_3.6.4. Ensure outbound and established connections are configured"
iptables -L -v -n 2>/dev/null
t=$_
check_file $t
echo

echo "*********************************************************************************************************"
echo "*********************************************************************************************************"


echo "UBTU_16.04_3.6.5. Ensure firewall rules exist for all open ports"
netstat -ln 2>/dev/null
t=$_
check_file $t
iptables -L INPUT -v -n
t=$_
check_file $t
echo



echo "*********************************************************************************************************"
echo "*********************************************************************************************************"

echo "UBTU_16.04_3.7. Ensure wireless interfaces are disabled"
iwconfig 2>/dev/null
t=$_
check_file $t
ip link show up
t=$_
check_file $t
echo


echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "................................................END OF OUTPUT............................................"
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"