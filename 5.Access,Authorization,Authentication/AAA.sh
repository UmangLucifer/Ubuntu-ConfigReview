# Type - Configuration Audit Script
# Author - Umang Verma
# Application Name - Ubuntu
#!/bin/bash


check_file(){
	x="$t"
	if [ ! -f $x ]; then
		echo "File $x not found"
	fi
}


echo "Audit script for Ubuntu is running. Kindly wait for the script to terminate."

exec > `hostname`_AAA.txt 2>errors5.txt

echo "LIN_00 - System Information"
hostname
/sbin/ifconfig -a|grep "inet addr"

echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "....................................ACCESS, AUTHENTICATION, AUTHORIZATION........................."
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo " **********************************************Configure cron**************************************** "
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"echo "------------------------------"

echo "UBTU_16.04_5.1.1 Ensure cron daemon is enabled (Scored)"
systemctl is-enabled crond 2>/dev/null
t=$_
check_file $t
echo
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"

echo "UBTU_16.04_5.1.2 Ensure permissions on /etc/crontab are configured (Scored)"
stat /etc/crontab 2>/dev/null
t=$_
check_file $t
echo

echo "*********************************************************************************************************"
echo "*********************************************************************************************************"

echo "UBTU_16.04_5.1.3 Ensure permissions on /etc/cron.hourly are configured (Scored)"
stat /etc/cron.hourly 2>/dev/null
t=$_
check_file $t
echo

echo "*********************************************************************************************************"
echo "*********************************************************************************************************"

echo "UBTU_16.04_5.1.4 Ensure permissions on /etc/cron.daily are configured (Scored)"
stat /etc/cron.daily 2>/dev/null
t=$_
check_file $t
echo

echo "*********************************************************************************************************"
echo "*********************************************************************************************************"

echo "UBTU_16.04_5.1.5 Ensure permissions on /etc/cron.weekly are configured (Scored)"
stat /etc/cron.weekly 2>/dev/null
t=$_
check_file $t
echo

echo "*********************************************************************************************************"
echo "*********************************************************************************************************"

echo "UBTU_16.04_5.1.6 Ensure permissions on /etc/cron.monthly are configured (Scored)"
stat /etc/cron.monthly 2>/dev/null
t=$_
check_file $t
echo

echo "*********************************************************************************************************"
echo "*********************************************************************************************************"

echo "UBTU_16.04_5.1.7 Ensure permissions on /etc/cron.d are configured (Scored)"
stat /etc/cron.d 2>/dev/null
t=$_
check_file $t
echo

echo "*********************************************************************************************************"
echo "*********************************************************************************************************"

echo "UBTU_16.04_5.1.8 Ensure at/cron is restricted to authorized users (Scored)"
stat /etc/cron.deny 2>/dev/null
t=$_
check_file $t
stat /etc/at.deny 
t=$_
check_file $t
stat /etc/cron.allow 
t=$_
check_file $t
stat /etc/at.allow 
t=$_
check_file $t
echo

echo "*********************************************************************************************************"
echo "*********************************************************************************************************"





echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo " ************************************SSH Server Configuration ****************************** "
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"





echo "UBTU_16.04_5.2.1 Ensure permissions on /etc/ssh/sshd_config are configured (Scored)"
stat /etc/ssh/sshd_config 2>/dev/null
t=$_
check_file $t
echo

echo "*********************************************************************************************************"
echo "*********************************************************************************************************"


echo "UBTU_16.04_5.2.2 Ensure SSH Protocol is set to 2 (Scored)"
grep "^Protocol" /etc/ssh/sshd_config 2>/dev/null
t=$_
check_file $t
echo

echo "*********************************************************************************************************"
echo "*********************************************************************************************************"

echo "UBTU_16.04_5.2.3 Ensure SSH LogLevel is set to INFO (Scored)"
grep "^LogLevel" /etc/ssh/sshd_config 2>/dev/null
t=$_
check_file $t
echo

echo "*********************************************************************************************************"
echo "*********************************************************************************************************"

echo "UBTU_16.04_5.2.4 Ensure SSH X11 forwarding is disabled (Scored)"
grep "^X11Forwarding" /etc/ssh/sshd_config 2>/dev/null
t=$_
check_file $t
echo
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"




echo "UBTU_16.04_5.2.5 Ensure SSH MaxAuthTries is set to 4 or less (Scored)"
grep "^MaxAuthTries" /etc/ssh/sshd_config 2>/dev/null
t=$_
check_file $t
echo

echo "*********************************************************************************************************"
echo "*********************************************************************************************************"





echo "UBTU_16.04_5.2.6 Ensure SSH IgnoreRhosts is enabled (Scored)"
grep "^IgnoreRhosts" /etc/ssh/sshd_config 2>/dev/null
t=$_
check_file $t
echo

echo "*********************************************************************************************************"
echo "*********************************************************************************************************"



echo "UBTU_16.04_5.2.7 Ensure SSH HostbasedAuthentication is disabled (Scored)"
grep "^HostbasedAuthentication" /etc/ssh/sshd_config 2>/dev/null
t=$_
check_file $t
echo

echo "*********************************************************************************************************"
echo "*********************************************************************************************************"


echo "UBTU_16.04_5.2.8 Ensure SSH root login is disabled (Scored)"
grep "^PermitRootLogin" /etc/ssh/sshd_config 2>/dev/null
t=$_
check_file $t
echo
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"




echo "UBTU_16.04_5.2.9 Ensure SSH PermitEmptyPasswords is disabled (Scored)"
grep "^PermitEmptyPasswords" /etc/ssh/sshd_config 2>/dev/null
t=$_
check_file $t
echo


echo "*********************************************************************************************************"
echo "*********************************************************************************************************"


echo "UBTU_16.04_5.2.10 Ensure SSH PermitUserEnvironment is disabled (Scored)"
grep PermitUserEnvironment /etc/ssh/sshd_config 2>/dev/null
t=$_
check_file $t
echo

echo "*********************************************************************************************************"
echo "*********************************************************************************************************"

echo "UBTU_16.04_5.2.11 Ensure only approved MAC algorithms are used (Scored)"
grep "MACs" /etc/ssh/sshd_config 2>/dev/null
t=$_
check_file $t
echo

echo "*********************************************************************************************************"
echo "*********************************************************************************************************"



echo "UBTU_16.04_5.2.12 Ensure SSH Idle Timeout Interval is configured (Scored)"
grep "^ClientAliveInterval" /etc/ssh/sshd_config 2>/dev/null
t=$_
check_file $t
grep "^ClientAliveCountMax" /etc/ssh/sshd_config 
t=$_
check_file $t
echo

echo "*********************************************************************************************************"
echo "*********************************************************************************************************"



echo "UBTU_16.04_5.2.13 Ensure SSH LoginGraceTime is set to one minute or less (Scored)"
grep "^LoginGraceTime" /etc/ssh/sshd_config 2>/dev/null
t=$_
check_file $t
echo


echo "*********************************************************************************************************"
echo "*********************************************************************************************************"



echo "UBTU_16.04_5.2.14 Ensure SSH access is limited (Scored)"
grep "^AllowUsers" /etc/ssh/sshd_config 2>/dev/null
t=$_
check_file $t
grep "^AllowGroups" /etc/ssh/sshd_config 
t=$_
check_file $t
grep "^DenyUsers" /etc/ssh/sshd_config 
t=$_
check_file $t
grep "^DenyGroups" /etc/ssh/sshd_config 
t=$_
check_file $t
echo

echo "*********************************************************************************************************"
echo "*********************************************************************************************************"




echo "UBTU_16.04_5.2.15 Ensure SSH warning banner is configured (Scored)"
grep "^Banner" /etc/ssh/sshd_config 2>/dev/null
t=$_
check_file $t
echo

echo "*********************************************************************************************************"
echo "*********************************************************************************************************"





echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo " ************************************Configure PAM*************************************** "
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"






echo "UBTU_16.04_5.3.1 Ensure password creation requirements are configured (Scored)"
grep pam_pwquality.so /etc/pam.d/common-password 2>/dev/null
t=$_
check_file $t
grep ^minlen /etc/security/pwquality.conf 
t=$_
check_file $t
grep ^dcredit /etc/security/pwquality.conf 
t=$_
check_file $t
grep ^lcredit /etc/security/pwquality.conf 
t=$_
check_file $t
grep ^ocredit /etc/security/pwquality.conf
t=$_
check_file $t
grep ^ucredit /etc/security/pwquality.conf 
t=$_
check_file $t
echo

echo "*********************************************************************************************************"
echo "*********************************************************************************************************"




echo "UBTU_16.04_5.3.2 Ensure lockout for failed password attempts is configured (Not Scored)"
grep "pam_tally2" /etc/pam.d/common-auth 2>/dev/null
t=$_
check_file $t
echo

echo "*********************************************************************************************************"
echo "*********************************************************************************************************"

echo "UBTU_16.04_5.3.3 Ensure password reuse is limited (Scored)"
egrep '^password\s+sufficient\s+pam_unix.so' /etc/pam.d/common-password 2>/dev/null
t=$_
check_file $t
echo


echo "*********************************************************************************************************"
echo "*********************************************************************************************************"


echo "UBTU_16.04_5.3.4 Ensure password hashing algorithm is SHA-512 (Scored)"
egrep '^password\s+\S+\s+pam_unix.so' /etc/pam.d/common-password 2>/dev/null
t=$_
check_file $t
echo


echo "*********************************************************************************************************"
echo "*********************************************************************************************************"


echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo " ******************************************* User Accounts and Environment ************************ "
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"



echo "UBTU_16.04_5.4.1.1 Ensure password expiration is 90 days or less"
grep PASS_MAX_DAYS /etc/login.defs 2>/dev/null
t=$_
check_file $t
egrep ^[^:]+:[^\!*] /etc/shadow | cut -d: -f1 
t=$_
check_file $t
chage --list nsadmin 
t=$_
check_file $t
echo

echo "*********************************************************************************************************"
echo "*********************************************************************************************************"

echo "UBTU_16.04_5.4.1.2 Ensure minimum days between password changes is 7 or more (Scored)"
grep PASS_MIN_DAYS /etc/login.defs 2>/dev/null
t=$_
check_file $t

echo
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"



echo "UBTU_16.04_5.4.1.3 Ensure password expiration warning days is 7 or more (Scored)"
grep PASS_WARN_AGE /etc/login.defs 2>/dev/null
t=$_
check_file $t

echo

echo "*********************************************************************************************************"
echo "*********************************************************************************************************"




echo "UBTU_16.04_5.4.1.4 Ensure inactive password lock is 30 days or less (Scored)"
useradd -D | grep INACTIVE 2>/dev/null
t=$_
check_file $t
echo

echo "*********************************************************************************************************"
echo "*********************************************************************************************************"



echo "UBTU_16.04_5.4.2 Ensure system accounts are non-login (Scored)"
egrep -v "^\+" /etc/passwd | awk -F: '($1!="root" && $1!="sync" && $1!="shutdown" && $1!="halt" && $3<1000 && $7!="/usr/sbin/nologin" && $7!="/bin/false") {print}' 2>/dev/null
t=$_
check_file $t
echo

echo "*********************************************************************************************************"
echo "*********************************************************************************************************"



echo "UBTU_16.04_5.4.3 Ensure default group for the root account is GID 0 (Scored)"
grep "^root:" /etc/passwd | cut -f4 -d: 2>/dev/null
t=$_
check_file $t
echo

echo "*********************************************************************************************************"
echo "*********************************************************************************************************"

echo "UBTU_16.04_5.4.4 Ensure default user umask is 027 or more restrictive (Scored)"
grep "^umask" /etc/bash.bashrc 2>/dev/null
t=$_
check_file $t
grep "^umask" /etc/profile 
t=$_
check_file $t
echo



echo "*********************************************************************************************************"
echo "*********************************************************************************************************"

echo "UBTU_16.04_5.5 Ensure root login is restricted to system console (Not Scored)"
cat /etc/securetty 2>/dev/null
t=$_
check_file $t
echo

echo "*********************************************************************************************************"
echo "*********************************************************************************************************"

echo "UBTU_16.04_5.6 Ensure access to the su command is restricted (Scored)"
grep pam_wheel.so /etc/pam.d/su 2>/dev/null
t=$_
check_file $t
grep wheel /etc/group 
t=$_
check_file $t
echo
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"

echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo ".............................................END OF OUTPUT..............................................."
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"
echo "*********************************************************************************************************"